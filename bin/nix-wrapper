#!/usr/bin/env bash
# Generic wrapper for running commands inside nix develop.
# Symlink to this file with the name of the command you want to wrap.
# Example: ln -s nix-wrapper node

progName=$(basename "$0")
scriptDir=$(cd "$(dirname "$0")" && pwd)
# Find the real program, excluding our bin/ directory
prog=$(type -Pa "$progName" | grep -v "^$scriptDir/" | head -1)
# IN_NIX_DEVELOP is set by flake.nix shellHook
# Change to PROJECT_ROOT if defined (useful for subprojects)
if (( IN_NIX_DEVELOP )); then
    [[ -n "$PROJECT_ROOT" ]] && echo -e "\e[93mcd $PROJECT_ROOT\e[0m" && cd "$PROJECT_ROOT"
    exec $prog "$@"
fi
exec nix develop -c $progName "$@"
